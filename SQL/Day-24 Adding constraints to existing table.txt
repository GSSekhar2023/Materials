
20-APR-23
 
Adding constraints to existing table :- 
------------------------------------------------

 => "ALTER" command is used to add constraints to existing table.

       CREATE TABLE emp99
       (
          empno  INT ,
          ename  VARCHAR(10) ,
          sal        MONEY,
          dno       INT 
       )

 Adding primary key :- 
 ---------------------------

 => primary key cannot be added to nullable column.
 => to add primary key first change the column to not null. 

 Ex :- 

  => add primary key to empno  ?

    STEP 1 :-  change column empno to not null

     ALTER TABLE emp99
             ALTER COLUMN empno  VARCHAR(10) NOT NULL
 
    STEP 2 :-  add primary key to empno 

    ALTER TABLE emp99
            ADD PRIMARY KEY(empno) 
  
  Adding check :- 
 ----------------------

  => add check constraint with condition sal >= 3000 ?
 
       ALTER TABLE emp99 
                  ADD CHECK(sal>=3000) 

        
          ALTER TABLE emp 
                  ADD CHECK(sal>=3000)  => ERROR

   note :- above command returns error because some of the employee salaries are
   less than 3000 , while adding constraint sql server also validates existing data ,
   if existing data satisfies the condition then constraint is added otherwise 
   not added.

   WITH NOCHECK :- 
   --------------------------

   =>  if constraint is added with "NO CHECK"  then sql server will not validate existing
         data and it validates only new data

       ALTER TABLE emp  
                WITH NOCHECK ADD CHECK(sal>=3000)  

   Adding foreign key :- 
  ---------------------------

   => add foreign key to dno that refers dept table primary key i.e. deptno 
 
     ALTER TABLE emp99
           ADD FOREIGN KEY(dno)  REFERENCES dept(deptno) 
 
  changing from NULL to NOT NULL :- 
  -------------------------------------------------

  =>  modify the column ename to not null ?

      ALTER TABLE emp99
             ALTER COLUMN ename VARCHAR(10) NOT NULL 

   Droping constraints :- 
   -----------------------------
 
   ALTER TABLE <TABNAME>
              DROP  CONSTRAINT  <NAME> 

 => drop check constraint in emp99 table ?

     ALTER TABLE emp99
         DROP CONSTRAINT  CK__emp99__sal__72C60C4A

 => drop primary key in dept table ?

       ALTER TABLE DEPT
               DROP CONSTRAINT PK__DEPT__E0EB08D79BEB42A8 => ERROR

      DROP TABLE DEPT  => ERROR 

      TRUNCATE TABLE DEPT  => ERROR


  NOTE :- 

   1   primary key cannot be dropped if referenced by some fk
   2   primary key table cannot be dropped if referenced by some fk
   3   primary key table cannot be truncated if referenced by some fk